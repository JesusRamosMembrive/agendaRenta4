{% extends "base.html" %}

{% block title %}Test Runner - Crawler{% endblock %}

{% block content %}
<!-- ===============================================================
     Page Header
     =============================================================== -->
<div class="page-header">
  <h1 class="page-title">Test Runner</h1>
  <p class="page-description">
    Configura y ejecuta tests de calidad para el sitio web
  </p>
</div>

<!-- ===============================================================
     Configuration Section
     =============================================================== -->
<div class="card" style="margin-bottom: var(--space-xl); border-left: 4px solid var(--primary);">
  <h3 style="margin: 0 0 var(--space-sm) 0; font-size: var(--text-xl); font-weight: var(--font-bold); color: var(--text); display: flex; align-items: center; gap: var(--space-sm);">
    <i data-lucide="settings" class="icon-md"></i>
    <span>Configuración de Tests</span>
  </h3>
  <p style="color: var(--muted); margin-bottom: var(--space-lg); font-size: var(--text-sm);">
    Selecciona qué tests ejecutar y su alcance. Esta configuración se sincroniza con la página de Configuración.
  </p>

  {% for check_type, check_info in available_checks.items() %}
  {% set config = config_dict.get(check_type, {}) %}
  {% set is_available = check_info.get('available', True) %}

  <div class="check-config-card" style="
    background: var(--bg-secondary);
    padding: var(--space-lg);
    border-radius: var(--radius-md);
    margin-bottom: var(--space-md);
    border: 2px solid {% if config.get('enabled') and is_available %}var(--success){% else %}var(--border){% endif %};
    {% if not is_available %}opacity: 0.6;{% endif %}
  ">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-md);">
      <div style="display: flex; align-items: center; gap: var(--space-md);">
        <i data-lucide="{{ check_info.icon_name }}" class="icon-lg"></i>
        <div>
          <div style="font-weight: var(--font-semibold); font-size: var(--text-base); color: var(--text); display: flex; align-items: center; gap: var(--space-sm);">
            {{ check_info.name }}
            {% if not is_available %}
            <span class="badge badge-warning">Próximamente</span>
            {% endif %}
          </div>
          <div style="color: var(--muted); font-size: var(--text-sm);">{{ check_info.description }}</div>
        </div>
      </div>

      {% if is_available %}
      <label style="display: flex; align-items: center; cursor: pointer;">
        <input type="checkbox"
               id="{{ check_type }}_enabled"
               data-check-type="{{ check_type }}"
               {% if config.get('enabled') %}checked{% endif %}
               style="width: 20px; height: 20px; cursor: pointer;">
        <span style="margin-left: var(--space-sm); font-weight: var(--font-semibold); color: var(--text);">Activo</span>
      </label>
      {% endif %}
    </div>

    {% if is_available %}
    <div style="display: flex; gap: var(--space-xl); align-items: center; padding-left: 48px;">
      <div>
        <label style="font-size: var(--text-sm); color: var(--muted); font-weight: var(--font-semibold); display: block; margin-bottom: var(--space-xs);">
          Alcance:
        </label>
        <select id="{{ check_type }}_scope"
                data-check-type="{{ check_type }}"
                style="padding: var(--space-sm) var(--space-md); border: 1px solid var(--border); border-radius: var(--radius-sm); font-size: var(--text-sm); cursor: pointer; background: var(--bg); color: var(--text);">
          {% if check_type == 'broken_links' %}
          <option value="priority" {% if config.get('scope') == 'priority' %}selected{% endif %}>
            Priority (~117 URLs • 2-3 min)
          </option>
          <option value="all" {% if config.get('scope') == 'all' %}selected{% endif %}>
            All (~2,800 URLs • 45-60 min)
          </option>
          {% elif check_type == 'image_quality' %}
          <option value="priority" {% if config.get('scope') == 'priority' %}selected{% endif %}>
            Priority (~117 URLs • 5-10 min)
          </option>
          <option value="all" {% if config.get('scope') == 'all' %}selected{% endif %}>
            All (~2,800 URLs • 2 HORAS)
          </option>
          {% elif check_type == 'spell_check' %}
          <option value="priority" {% if config.get('scope') == 'priority' %}selected{% endif %}>
            Priority (~117 URLs • 3-5 min)
          </option>
          <option value="all" {% if config.get('scope') == 'all' %}selected{% endif %}>
            All (~2,800 URLs • 60-70 min)
          </option>
          {% else %}
          <option value="priority" {% if config.get('scope') == 'priority' %}selected{% endif %}>
            Priority (~117 URLs)
          </option>
          <option value="all" {% if config.get('scope') == 'all' %}selected{% endif %}>
            All (~2,800 URLs)
          </option>
          {% endif %}
        </select>
      </div>

      <div>
        <label style="font-size: var(--text-sm); color: var(--muted); font-weight: var(--font-semibold); display: flex; align-items: center; cursor: pointer;">
          <input type="checkbox"
                 id="{{ check_type }}_auto"
                 data-check-type="{{ check_type }}"
                 {% if config.get('run_after_crawl') %}checked{% endif %}
                 style="width: 16px; height: 16px; margin-right: var(--space-xs); cursor: pointer;">
          Ejecutar automáticamente después del crawl
        </label>
      </div>
    </div>
    {% endif %}
  </div>
  {% endfor %}

  <div style="margin-top: var(--space-lg); display: flex; gap: var(--space-md); align-items: center;">
    <button onclick="saveConfig()" id="saveConfigBtn" class="btn primary">
      <i data-lucide="save" class="icon-xs"></i>
      <span>Guardar Configuración</span>
    </button>
    <span id="saveStatus" style="display: none; padding: var(--space-md); color: var(--success); font-weight: var(--font-semibold);"></span>
  </div>
</div>

<!-- ===============================================================
     Execution Section
     =============================================================== -->
<div class="card" style="margin-bottom: var(--space-xl); border-left: 4px solid var(--primary);">
  <h3 style="margin: 0 0 var(--space-md) 0; font-size: var(--text-xl); font-weight: var(--font-bold); color: var(--text); display: flex; align-items: center; gap: var(--space-sm);">
    <i data-lucide="rocket" class="icon-md"></i>
    <span>Ejecutar Tests</span>
  </h3>
  <p style="margin-bottom: var(--space-lg); color: var(--text-secondary);">
    Los tests se ejecutarán de forma secuencial. <strong style="color: var(--danger);">IMPORTANTE: NO cierres esta ventana hasta que terminen.</strong>
  </p>

  <div style="background: var(--warning-light); padding: var(--space-md); border-radius: var(--radius-md); margin-bottom: var(--space-lg); border-left: 4px solid var(--warning);">
    <div style="display: flex; align-items: flex-start; gap: var(--space-sm);">
      <i data-lucide="clock" class="icon-sm" style="color: var(--warning); flex-shrink: 0; margin-top: 2px;"></i>
      <div>
        <p style="margin: 0 0 var(--space-xs) 0; font-weight: var(--font-semibold); color: var(--text);">Tiempos estimados (scope Priority):</p>
        <ul style="margin: 0; padding-left: var(--space-lg); line-height: 1.6; font-size: var(--text-sm); color: var(--text-secondary);">
          <li>Enlaces Rotos: 2-3 minutos</li>
          <li>Calidad de Imágenes: 5-10 minutos</li>
        </ul>
        <p style="margin: var(--space-sm) 0 0 0; font-weight: var(--font-bold); color: var(--warning);">Scope All puede tardar HORAS - recomendamos Priority para primeras pruebas.</p>
      </div>
    </div>
  </div>

  <button onclick="runAllTests()" id="runTestsBtn" class="btn primary" style="
    padding: var(--space-lg) var(--space-2xl);
    font-size: var(--text-lg);
    font-weight: var(--font-bold);
  ">
    <i data-lucide="play" class="icon-sm"></i>
    <span>Ejecutar Tests Activos</span>
  </button>
</div>

<!-- ===============================================================
     Progress Section (Hidden initially)
     =============================================================== -->
<div id="progressSection" style="display: none;" class="card" style="margin-bottom: var(--space-xl);">
  <h3 style="margin: 0 0 var(--space-lg) 0; font-size: var(--text-xl); font-weight: var(--font-bold); color: var(--text); display: flex; align-items: center; gap: var(--space-sm);">
    <i data-lucide="loader" class="icon-md"></i>
    <span>Progreso de Ejecución</span>
  </h3>

  <div id="progressContainer">
    <!-- Progress items will be added here dynamically -->
  </div>

  <div style="margin-top: var(--space-lg); padding: var(--space-md); background: var(--bg-secondary); border-radius: var(--radius-sm); text-align: center;">
    <span id="overallStatus" style="font-weight: var(--font-semibold); color: var(--text);">Iniciando tests...</span>
  </div>
</div>

<!-- ===============================================================
     Results Section (Hidden initially)
     =============================================================== -->
<div id="resultsSection" style="display: none; margin-bottom: var(--space-xl);">
  <h3 style="margin-bottom: var(--space-lg); font-size: var(--text-xl); font-weight: var(--font-bold); color: var(--text); display: flex; align-items: center; gap: var(--space-sm);">
    <i data-lucide="bar-chart-3" class="icon-md"></i>
    <span>Resultados</span>
  </h3>
  <div id="resultsContainer" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: var(--space-lg);">
    <!-- Result cards will be added here dynamically -->
  </div>
</div>

<style>
.check-config-card input[type="checkbox"]:checked ~ * {
  color: var(--success);
}

.test-progress {
  background: var(--bg-secondary);
  padding: var(--space-lg);
  border-radius: var(--radius-md);
  margin-bottom: var(--space-md);
  border-left: 4px solid var(--border);
}

.test-progress.running {
  border-left-color: var(--primary);
}

.test-progress.completed {
  border-left-color: var(--success);
}

.test-progress.error {
  border-left-color: var(--danger);
}

.progress-bar-container {
  background: var(--border);
  height: 8px;
  border-radius: var(--radius-sm);
  overflow: hidden;
  margin: var(--space-sm) 0;
  position: relative;
}

.progress-bar-fill {
  background: linear-gradient(90deg, var(--primary) 0%, var(--success) 100%);
  height: 100%;
  width: 0%;
  transition: width 0.3s ease;
  position: relative;
}

@keyframes progressSlide {
  0% {
    left: -40%;
  }
  100% {
    left: 100%;
  }
}

.result-card {
  background: var(--bg);
  padding: var(--space-xl);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow);
  border-left: 4px solid var(--border);
}

.result-card.ok {
  border-left-color: var(--success);
}

.result-card.warning {
  border-left-color: var(--warning);
}

.result-card.error {
  border-left-color: var(--danger);
}

.result-card.completed {
  border-left-color: var(--success);
}
</style>

<script>
// Initialize Lucide icons
document.addEventListener('DOMContentLoaded', function() {
  lucide.createIcons();
});

// ========== Configuration Management ==========

async function saveConfig() {
  const saveBtn = document.getElementById('saveConfigBtn');
  const saveStatus = document.getElementById('saveStatus');

  saveBtn.disabled = true;
  saveBtn.innerHTML = '<i data-lucide="loader" class="icon-xs"></i><span>Guardando...</span>';
  lucide.createIcons();
  saveStatus.style.display = 'none';

  const checks = ['broken_links', 'image_quality', 'spell_check'];
  let successCount = 0;

  for (const checkType of checks) {
    const enabledCheckbox = document.getElementById(`${checkType}_enabled`);
    const scopeSelect = document.getElementById(`${checkType}_scope`);
    const autoCheckbox = document.getElementById(`${checkType}_auto`);

    if (!enabledCheckbox) continue;

    try {
      const response = await fetch('/crawler/config/checks', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          check_type: checkType,
          enabled: enabledCheckbox.checked,
          scope: scopeSelect.value,
          run_after_crawl: autoCheckbox.checked
        })
      });

      const data = await response.json();
      if (data.success) {
        successCount++;
      } else {
        console.error(`Error saving ${checkType}:`, data.error);
      }
    } catch (error) {
      console.error(`Error saving ${checkType}:`, error);
    }
  }

  saveBtn.disabled = false;
  saveBtn.innerHTML = '<i data-lucide="save" class="icon-xs"></i><span>Guardar Configuración</span>';
  lucide.createIcons();

  if (successCount === checks.length) {
    saveStatus.innerHTML = '<i data-lucide="check-circle" class="icon-xs"></i><span>Configuración guardada correctamente</span>';
    saveStatus.style.color = 'var(--success)';
  } else {
    saveStatus.innerHTML = `<i data-lucide="alert-triangle" class="icon-xs"></i><span>Guardado parcial (${successCount}/${checks.length})</span>`;
    saveStatus.style.color = 'var(--warning)';
  }
  saveStatus.style.display = 'flex';
  saveStatus.style.alignItems = 'center';
  saveStatus.style.gap = 'var(--space-xs)';
  lucide.createIcons();

  setTimeout(() => {
    saveStatus.style.display = 'none';
  }, 3000);
}

// ========== Test Execution ==========

async function runAllTests() {
  // Get enabled tests
  const enabledTests = [];
  const testConfigs = [];

  const checks = ['broken_links', 'image_quality', 'spell_check'];
  for (const checkType of checks) {
    const enabledCheckbox = document.getElementById(`${checkType}_enabled`);
    const scopeSelect = document.getElementById(`${checkType}_scope`);

    if (enabledCheckbox && enabledCheckbox.checked) {
      enabledTests.push(checkType);
      testConfigs.push({
        check_type: checkType,
        scope: scopeSelect.value
      });
    }
  }

  if (enabledTests.length === 0) {
    alert('No hay tests activos. Por favor activa al menos un test en la configuración.');
    return;
  }

  // Warn if using 'all' scope - show detailed time estimates
  const hasAllScope = testConfigs.some(config => config.scope === 'all');
  if (hasAllScope) {
    // Calculate time estimates
    let timeEstimate = '';
    testConfigs.forEach(config => {
      if (config.scope === 'all') {
        if (config.check_type === 'broken_links') {
          timeEstimate += '\n  • Enlaces Rotos: ~45-60 minutos';
        } else if (config.check_type === 'image_quality') {
          timeEstimate += '\n  • Calidad de Imágenes: ~2 HORAS';
        } else if (config.check_type === 'spell_check') {
          timeEstimate += '\n  • Ortografía: ~60-70 minutos';
        }
      }
    });

    const confirmed = confirm(
      '⚠️ ADVERTENCIA: Has seleccionado scope "All"\n\n' +
      'Esto procesará ~2,800 URLs y tardará MUCHO TIEMPO:\n' +
      timeEstimate + '\n\n' +
      'Recomendación: Usa scope "Priority" primero:\n' +
      '  • ~117 URLs\n' +
      '  • Enlaces Rotos: ~2-3 minutos\n' +
      '  • Imágenes: ~5-10 minutos\n' +
      '  • Ortografía: ~3-5 minutos\n\n' +
      '¿Deseas continuar con scope "All"?'
    );
    if (!confirmed) {
      return;
    }
  }

  // Disable button
  const runBtn = document.getElementById('runTestsBtn');
  runBtn.disabled = true;
  runBtn.innerHTML = '<i data-lucide="loader" class="icon-sm"></i><span>Ejecutando...</span>';
  lucide.createIcons();

  // Show progress section
  showProgressSection(enabledTests);

  // Execute tests sequentially
  const results = {};
  for (let i = 0; i < testConfigs.length; i++) {
    const config = testConfigs[i];
    const checkType = config.check_type;

    // Update progress UI
    updateTestProgress(checkType, 'running', 'Ejecutando...');

    try {
      const result = await executeTest(config);
      results[checkType] = result;

      if (result.success) {
        updateTestProgress(checkType, 'completed', 'Completado');
      } else {
        updateTestProgress(checkType, 'error', 'Error');
      }
    } catch (error) {
      console.error(`Error executing ${checkType}:`, error);
      results[checkType] = { success: false, error: error.message };
      updateTestProgress(checkType, 'error', 'Error');
    }

    // Small delay between tests
    if (i < testConfigs.length - 1) {
      await new Promise(resolve => setTimeout(resolve, 1000));
    }
  }

  // Hide progress, show results
  document.getElementById('progressSection').style.display = 'none';
  showResults(results);

  // Re-enable button
  runBtn.disabled = false;
  runBtn.innerHTML = '<i data-lucide="play" class="icon-sm"></i><span>Ejecutar Tests Activos</span>';
  lucide.createIcons();
}

async function executeTest(config) {
  try {
    // Show time estimates based on check type and scope
    const statusElement = document.getElementById(`status_${config.check_type}`);

    if (config.scope === 'priority') {
      // Priority scope: ~117 URLs
      if (config.check_type === 'broken_links') {
        statusElement.innerHTML = '<i data-lucide="loader" class="icon-xs"></i><span>Ejecutando (~2-3 minutos)...</span>';
      } else if (config.check_type === 'image_quality') {
        statusElement.innerHTML = '<i data-lucide="loader" class="icon-xs"></i><span>Ejecutando (~5-10 minutos, por favor espere)...</span>';
      } else if (config.check_type === 'spell_check') {
        statusElement.innerHTML = '<i data-lucide="loader" class="icon-xs"></i><span>Ejecutando (~3-5 minutos)...</span>';
      }
    } else if (config.scope === 'all') {
      // All scope: ~2,800 URLs
      if (config.check_type === 'broken_links') {
        statusElement.innerHTML = '<i data-lucide="loader" class="icon-xs"></i><span>Ejecutando (~45-60 minutos, MUCHO TIEMPO)...</span>';
      } else if (config.check_type === 'image_quality') {
        statusElement.innerHTML = '<i data-lucide="loader" class="icon-xs"></i><span>Ejecutando (~2 HORAS, por favor tenga paciencia)...</span>';
      } else if (config.check_type === 'spell_check') {
        statusElement.innerHTML = '<i data-lucide="loader" class="icon-xs"></i><span>Ejecutando (~60-70 minutos, MUCHO TIEMPO)...</span>';
      }
    }
    lucide.createIcons();

    const response = await fetch('/crawler/quality/run', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        check_types: [config.check_type],
        scope: config.scope
      })
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();
    return data;
  } catch (error) {
    console.error('Error executing test:', error);
    return {
      success: false,
      error: error.message || 'Error desconocido al ejecutar test'
    };
  }
}

function showProgressSection(testTypes) {
  const progressSection = document.getElementById('progressSection');
  const progressContainer = document.getElementById('progressContainer');

  progressContainer.innerHTML = '';

  const testNames = {
    'broken_links': { icon: 'link-2', name: 'Enlaces Rotos' },
    'image_quality': { icon: 'image', name: 'Calidad de Imágenes' },
    'spell_check': { icon: 'file-text', name: 'Ortografía' }
  };

  testTypes.forEach(checkType => {
    const info = testNames[checkType];
    const progressHTML = `
      <div id="progress_${checkType}" class="test-progress">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-sm);">
          <span style="font-weight: var(--font-semibold); font-size: var(--text-base); display: flex; align-items: center; gap: var(--space-sm);">
            <i data-lucide="${info.icon}" class="icon-sm"></i>
            <span>${info.name}</span>
          </span>
          <span id="status_${checkType}" style="font-size: var(--text-sm); color: var(--muted); display: flex; align-items: center; gap: var(--space-xs);">
            <i data-lucide="pause-circle" class="icon-xs"></i>
            <span>Pendiente</span>
          </span>
        </div>
        <div class="progress-bar-container">
          <div id="bar_${checkType}" class="progress-bar-fill"></div>
        </div>
      </div>
    `;
    progressContainer.innerHTML += progressHTML;
  });

  lucide.createIcons();
  progressSection.style.display = 'block';
  document.getElementById('overallStatus').textContent = 'Iniciando tests...';
}

function updateTestProgress(checkType, status, statusText) {
  const progressDiv = document.getElementById(`progress_${checkType}`);
  const statusSpan = document.getElementById(`status_${checkType}`);
  const progressBar = document.getElementById(`bar_${checkType}`);

  if (progressDiv) {
    progressDiv.className = `test-progress ${status}`;
  }

  if (statusSpan) {
    if (status === 'running') {
      statusSpan.innerHTML = `<i data-lucide="loader" class="icon-xs"></i><span>${statusText}</span>`;
    } else if (status === 'completed') {
      statusSpan.innerHTML = `<i data-lucide="check-circle" class="icon-xs"></i><span>${statusText}</span>`;
    } else if (status === 'error') {
      statusSpan.innerHTML = `<i data-lucide="x-circle" class="icon-xs"></i><span>${statusText}</span>`;
    }
    statusSpan.style.display = 'flex';
    statusSpan.style.alignItems = 'center';
    statusSpan.style.gap = 'var(--space-xs)';
    lucide.createIcons();
  }

  if (progressBar) {
    if (status === 'running') {
      // Indeterminate animation
      progressBar.style.width = '40%';
      progressBar.style.animation = 'progressSlide 2s ease-in-out infinite';
    } else if (status === 'completed') {
      progressBar.style.animation = 'none';
      progressBar.style.width = '100%';
    } else if (status === 'error') {
      progressBar.style.animation = 'none';
      progressBar.style.width = '100%';
      progressBar.style.background = 'var(--danger)';
    }
  }
}

function showResults(results) {
  const resultsSection = document.getElementById('resultsSection');
  const resultsContainer = document.getElementById('resultsContainer');

  resultsContainer.innerHTML = '';

  const testInfo = {
    'broken_links': {
      icon: 'link-2',
      name: 'Enlaces Rotos',
      detailPage: '{{ url_for("crawler.broken") }}'
    },
    'image_quality': {
      icon: 'image',
      name: 'Calidad de Imágenes',
      detailPage: '{{ url_for("crawler.quality") }}'
    },
    'spell_check': {
      icon: 'file-text',
      name: 'Ortografía',
      detailPage: '{{ url_for("crawler.spell_check") }}'
    }
  };

  // Iterate through results (which contains the API response for each test)
  for (const [checkType, result] of Object.entries(results)) {
    const info = testInfo[checkType];

    // Extract check result from response structure
    // Response structure: { success: true, results: { checks: [...] } }
    let checkResult = {};

    if (result.success && result.results && result.results.checks) {
      // Find the check in the checks array
      const check = result.results.checks.find(c => c.check_type === checkType);
      if (check) {
        checkResult = check;
      }
    } else if (result.error) {
      checkResult = { status: 'error', message: result.error };
    }

    // Extract stats
    const stats = checkResult.stats || {};
    const isCompleted = checkResult.status === 'completed';

    const cardHTML = `
      <div class="result-card ${checkResult.status || 'error'}">
        <div style="display: flex; align-items: center; gap: var(--space-md); margin-bottom: var(--space-md);">
          <i data-lucide="${info.icon}" class="icon-2xl"></i>
          <div>
            <h3 style="margin: 0; font-size: var(--text-lg); color: var(--text);">${info.name}</h3>
            <span class="badge ${isCompleted ? 'badge-success' : 'badge-danger'}">
              <i data-lucide="${isCompleted ? 'check-circle' : 'x-circle'}" class="icon-xs"></i>
              <span>${isCompleted ? 'Completado' : 'Error'}</span>
            </span>
          </div>
        </div>

        <div style="background: var(--bg-secondary); padding: var(--space-md); border-radius: var(--radius-sm); margin-bottom: var(--space-md);">
          <p style="margin: var(--space-xs) 0; font-size: var(--text-sm); color: var(--text);">
            <strong>Mensaje:</strong> ${checkResult.message || 'Sin detalles'}
          </p>
          ${stats.validated ? `<p style="margin: var(--space-xs) 0; font-size: var(--text-sm); color: var(--text);"><strong>URLs validadas:</strong> ${stats.validated}</p>` : ''}
          ${stats.broken !== undefined ? `<p style="margin: var(--space-xs) 0; font-size: var(--text-sm); color: var(--text);"><strong>Enlaces rotos:</strong> ${stats.broken}</p>` : ''}
          ${stats.ok !== undefined ? `<p style="margin: var(--space-xs) 0; font-size: var(--text-sm); color: var(--text);"><strong>URLs OK:</strong> ${stats.ok}</p>` : ''}
        </div>

        <a href="${info.detailPage}" class="btn primary" style="text-decoration: none; display: inline-flex;">
          <i data-lucide="arrow-right" class="icon-xs"></i>
          <span>Ver Detalles Completos</span>
        </a>
      </div>
    `;

    resultsContainer.innerHTML += cardHTML;
  }

  lucide.createIcons();
  resultsSection.style.display = 'block';
  window.scrollTo({ top: resultsSection.offsetTop, behavior: 'smooth' });
}
</script>
{% endblock %}
